# profi_ru_bot
Бот для отслеживания новых заявок на сайте profi.ru, со встроенным браузером Chromium и GUI PySide6.

Заказчику требуется быстро реагировать на появление новых заявок.
По его наблюдениям, самые выгодные заказы в ленте заказов доступны в течении 20 секунд. Сайт устроен так, что на каждую заявку может ответитить только 10
возможных исполнителей, когда все слоты заполнены, заявка из доступа исчезает.
Как итог - заказчик не успевает реагировать и откликаться на выгодные заказы.
Ему требуется программа, которая будет сообщать ему о новых заявках, соответствующих выставленным фильтрам.

Напишу программу, которая решит поставленные задачи.

Основные трудности:
1.Нельзя создать автоотклик - заказчик не отвечает на все заявки подряд, его опыт позволят быстро оценить заявку и принять решение стоит ли на неё реагировать.

В случае ответа на все заявки подряд падает рейтинг, что неприемлимо.

2.Время реагирования <20 секунд.

Делаем вывод - окно с сайтом должно быть открыто всегда.

Этот вариант позволит отслеживать новые заявки и отвечать в том же окне браузера.

На данный момент вижу такое решение:

При запуске программы встроенный браузер будет открывать окно,
в этом окне пользователь перейдёт на сайт профи.ру (можно прописать автоматический переход на нужный сайт), залогинится, перейдёт на страницу заявок и настроит фильтры.
В самом окне помощника будет встроена кнопка старт/стоп.
При нажатии на старт бот начнёт обновлять страницу и при появлении новой заявки по заданным фильтрам включит звуковой сигнал.
После этого пользователю нужно будет нажать на кнопку стоп и он получит возможность в этом же окне ответить на заявку.

Ниже буду описывать реализацию, идеи и проблемы, с которыми буду сталкиваться.

1.Начнём с минимального прототипа:
Во встроенном браузере откроем окно - в этом окне отрыть profi.ru
Для этого используем PySide6 и встроенный в него QWebEngine.

Создала модуль gui, а в нём browser.py - описала класс встроенного браузера,
main_window.py - класс главного окна (пока без кнопок, но с заданным адресом
страницы сайта 'https://profi.ru/').
Точка входа в файле main.py.

Отлично, окно с браузером заработало, сайт profi.ru загружается и работает корректно.

2.Теперь добавим в виджет кнопку старт/стоп, которая запустит обновление страницы, пусть каждые 5 секунд.
Пока добавим только сами кнопки, без логики их обработки.

В файле control_buttons.py создала виджет с двумя кнопками старт и стоп в горизонтальной раскладке.
Добавила виджет с кнопками в главное окно в main_window.py, подключила кнопки к сигналам.
Пока логика работы приложения описывается в main_window.py.

Работает, НО!!!! блок кнопок по размеру такой же, как и сам браузер, нужно добавить настройки, чтобы блок кнопок был небольшим, а браузер занимал основное пространство. Оставлю это на конец, пока реализую основные функции бота.


3.Теперь добавим обновление страницы по таймеру.
Будем использовать QTimer из PySide6 и функцию reload().

Добавила модуль core/refresher.py, здесь логика запуска обновления страницы
запускается с помощью QTimer.
Подключила автообновления к кнопкам в главном окне main_window.py.

4.Виджеты браузера и кнопок были одного размера, что плохо, браузером неудобно пользоваться, настроила так, чтобы браузер занимал основное место в окне, а у кнопок был фиксированный размер.

5.Теперь задача отслеживать новые заявки.
Раз в обновление (через Refresher) будем проверять содержимое страницы (отслеживать DOM).
Хранить (пока условные ID), будем во множестве set (пока не ясен масштаб, возможно заменим на SQLite).
Если появился новый элемент, которого нет во множестве (новая заявка) - подаём сигнал (звук, уведомление).

Создала хранилище в utils/storage.py.

В core/notifier.py создала уведомления с помощью QSoundEffect, QMessageBox, QUrl. Простые звуковые файлы разместила в этой же директории.

Создала наблюдателя core/wacher.py, который связал парсинг по html странице с хранилищем id заявок и звуковым уведомлением (добавила так же и текстовое уведомление).
Для парсинга использовала библиотеку BeautifulSoup4.

Добавила в core/refresher.py в метод refresh проверку новых заявок после каждого обновления страницы.

Всё подключила в главном окне (хранилище, уведомления, наблюдателя),
запустила, работает. Но т.к. поиск пока не отлажен, бот ничего не находит, но сообщения о своей работе отправляет.
